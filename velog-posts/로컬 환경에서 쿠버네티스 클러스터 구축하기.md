<h2 id="쿠버네티스-설치-환경의-종류">쿠버네티스 설치 환경의 종류</h2>
<p>도커 엔진과 달리 쿠버네티스는 사용 환경과 목적에 따라 설치하는 방법이 매우 다양하고 복잡하다. 개발 용도로 로컬에서 사용하려면 별도의 어려움 없이 쉽게 설치할 수 있지만, 실제 운영 단계의 쿠버네티스 클러스터를 구축하려면 <strong>AWS, GKE(Google Kubernetes Engine)</strong> 등의 클라우드 환경에서 수십 개의 서버에 동시에 쿠버네티스를 설치해야 할 수도 있다.</p>
<ul>
<li>개발 용도의 쿠버네티스 설치: <strong>Minikube, Docker Desktop on Mac, Windows에 내장된 쿠버네티스</strong></li>
<li>서비스 테스트 또는 운영 용도의 쿠버네티스 설치: <strong>kops, kubespray, kubeadm, EKS, GKE 등의 매니지드 서비스</strong></li>
</ul>
<blockquote>
<p>현재 이 글에서는 <strong>kubeadm</strong>을 통해 쿠버네티스를 설치할 것이다!</p>
</blockquote>
<h2 id="kubeadm으로-쿠버네티스-설치">kubeadm으로 쿠버네티스 설치</h2>
<p><img alt="" src="https://velog.velcdn.com/images/ysheep0906/post/77c3156b-3668-4e67-84bb-07cb6d8564fd/image.png" /></p>
<p>kubadm은 쿠버네티스 커뮤니티에서 권장하는 설치 방법 중 하나이기 때문에 쿠버네티스를 처음 시작하는 사람도 쉽게 쿠버네티스 클러스터를 설치할 수 있다는 장점이 있다. <strong>온프레미스 환경, 클라우드 인프라 환경에 상관없이</strong> 일반적인 _<strong>리눅스 서버</strong>_라면 모두 사용할 수 있다!</p>
<p>일단 먼저 VMware 환경에서 Ubuntu 24.02- Server로 k8s-master, k8s-worker1, k8s-worker2를 준비한다. (총 노드를 3개로 진행한다) 각 서버의 IP는 아래와 같이 사용하겠다.</p>
<pre><code>k8s-master  10.10.10.10
k8s-worker1 10.10.10.11
k8s-worker2 10.10.10.12</code></pre><h3 id="ipv4-포워딩">IPv4 포워딩</h3>
<p>쿠버네티스는 Pod 간 통신을 위해 Linux 커널의 bridge 네트워크 기능을 사용한다. 즉, 각 Node에서 Pod들이 <strong>브리지 네트워크(가상 스위치)</strong>를 통해 서로 연결된다. 하지만 기본적으로 Linux 커널은** bridge 인터페이스를 통과하는 패킷을 iptables에서 처리하지 않기** 때문에 설정이 필요하다</p>
<ul>
<li><strong>br_netfilter 모듈을 로드</strong><pre><code>sudo vi /etc/modules-load.d/k8s.conf
</code></pre></li>
</ul>
<h1 id="아래와-같이-넣고-wq">아래와 같이 넣고 :wq</h1>
<p>overlay
br_netfilter</p>
<pre><code>- **커널에 등록**</code></pre><p>modprobe overlay
modprobe br_netfilter</p>
<pre><code>- **bridge traffic을 보게 할 커널 파라미터 수정 **
/etc/modules-load.d/k8s.conf에 br_netfilter를 추가해 부팅 시 자동으로 커널 모듈이 로드되게 해야 한다.</code></pre><p>sudo vi /etc/sysctl.d/k8s.conf</p>
<h1 id="아래와-같이-넣고-wq-1">아래와 같이 넣고 :wq</h1>
<p>net.bridge.bridge-nf-call-iptables  = 1
net.bridge.bridge-nf-call-ip6tables = 1
net.ipv4.ip_forward                 = 1</p>
<pre><code>
- **재부팅하지 않고 sysctl 파라미터 적용하기**</code></pre><p>sysctl --system</p>
<pre><code>


### 메모리 설정(Swap 끄기) - 모든 노드
모든 서버에서 메모리 스왑(Swap)을 비활성화한다. 메모리 스왑이 활성화돼 있으면 컨테이너의 성능이 일관되지 않을 수 있기 때문에 대부분의 쿠버네티스 설치 도구는 메모리 스왑을 허용하지 않는다</code></pre><p>swapoff -a &amp;&amp; sed -i '/swap/s/^/#/' /etc/fstab</p>
<pre><code>- swapoff -a: 현재 활성화된 모든 스왑 공간을 비활성화한다.
- sed -i '/swap/s/^/#/' /etc/fstab: /etc/fstab 파일에서 스왑 관련 항목을 찾아 주석 처리하여 재부팅 후에도 스왑이 자동으로 활성화되지 않도록 설정한다.

### 쿠버네티스 저장소 추가 - 모든 노드
apt 패키지 인덱스를 업데이트하고 쿠버네티스 apt 리포지터리를 사용하는 데 필요한 패키지를 설치한다.</code></pre><p>sudo apt-get update
sudo apt-get install -y apt-transport-https ca-certificates curl gpg</p>
<pre><code>
쿠버네티스 패키지 리포지터리용 공개 샤이닝 키를 다운로드한다. 모든 리포지터리에 동일한 서명 키가 사용되므로 URL의 버전은 무시할 수 있다.</code></pre><p>sudo curl -fsSL <a href="https://pkgs.k8s.io/core:/stable:/v1.34/deb/Release.key">https://pkgs.k8s.io/core:/stable:/v1.34/deb/Release.key</a> | sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg</p>
<pre><code>
쿠버네티스 apt 리포지터리를 추가한다.</code></pre><p>echo &quot;deb [signed-by=/etc/apt/keyrings/kubernetes-archive-keyring.gpg] <a href="https://apt.kubernetes.io/">https://apt.kubernetes.io/</a> kubernetes-xenial main&quot; | sudo tee /etc/apt/sources.list.d/kubernetes.list</p>
<pre><code>새로운 저장소가 추가되었으므로, repository update</code></pre><p>sudo apt update</p>
<pre><code>
### containerd 설치 - 모든 노드
쿠버네티스는 컨테이너 런타임 인터페이스(CRI)를 지원하는 구현체를 통해 컨테이너를 사용한다. containerd, cri-o 등이 컨테이너 런타임 인터페이스를 통해 컨에티어를 제어할 수 있는 방법을 제공한다.</code></pre><p>sudo apt install containerd.io -y</p>
<pre><code>
### crictl 명령 사용을 위한 환경구성 파일 생성 - 모든 노드
containerd 운영시 docker명령어로 컨테이너 관리 불가한다. docker 명령을 대신해서 crictl 명령을 실행해야 한다.
컨테이너는 표준이므로 어디에서 만들던지간에 모든 곳에서 사용할 수 있고 crictl 명령어 적용할 endpoint를 설정한다.</code></pre><p>sudo vi /etc/crictl.yaml</p>
<h1 id="아래와-같이-넣고-wq-2">아래와 같이 넣고 :wq</h1>
<p>runtime-endpoint: unix:///run/containerd/containerd.sock
image-endpoint: unix:///run/containerd/containerd.sock
timeout: 10
debug: true</p>
<pre><code>
### 일반 사용자에게도 containerd 사용 권한 할당 - 모든 노드
- containerd config file 구성</code></pre><p>mkdir -p /etc/containerd
containerd config default | sudo tee /etc/containerd/config.toml</p>
<pre><code>
- 구성 파일의 systemdCgroup = true로 수정</code></pre><h1 id="">...</h1>
<p>[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.runc]</p>
<h1 id="-1">...</h1>
<p>  [plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.runc.options]
    SystemdCgroup = true   #139라인(반드시 지정)</p>
<pre><code>
- 생략 가능하지만 crictl 명령어를 ubuntu 사용자가 실행할 수 있도록 uid, gid에 1000계정 할당 (원래는 root만 crictl 명령어  가능)</code></pre><h1 id="17-라인">17 라인</h1>
<p>[debug]
  gid = 1000
  uid = 1000</p>
<p>[grpc]
  gid = 1000
  uid = 1000</p>
<h1 id="288-라인">288 라인</h1>
<p>[ttrpc]
  gid = 1000
  uid = 1000</p>
<pre><code>
- containerd 재시작 후 서비스 동작 상태 확인(**active (running)**)</code></pre><p>systemctl restart containerd</p>
<p>systemctl status containerd</p>
<p>+</p>
<pre><code>
### kubeadm 설치 - 모든 노드
2025년 10월 기준 1.30.14-1.1 버전으로 설치함</code></pre><p>sudo apt-get install -y kubelet=1.30.14-1.1 kubeadm=1.30.14-1.1 kubectl=1.30.14-1.1 --allow-change-held-packages</p>
<pre><code>자동으로 업데이트하지 못하도록 holding한다.</code></pre><p>sudo apt-mark hold kubelet kubeadm kubectl</p>
<pre><code>
### 클러스터 설치 - _★마스터 노드만★_
- control-plaine 컴포넌트 구성</code></pre><p>kubeadm init --pod-network-cidr=192.168.0.0/16 --cri-socket unix:///var/run/containerd/containerd.sock</p>
<pre><code>**_결과 마지막 부분을 복사해 둔다. (kubeadm join …)_**


- 인증서를 복사한다.
</code></pre><p>mkdir -p $HOME/.kube
cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</p>
<pre><code>- 인증키 확인  </code></pre><p>cat .kube/config</p>
<pre><code>- 루트가 아닌 다른 계정도 사용할 수 있게 하기 위해  </code></pre><p>chown $(id -u):$(id -g) $HOME/.kube/config</p>
<pre><code>
### CNI 설치 - _★마스터 노드만★_
주로 Calico나 weave를 사용하는데 여기서는 weave를 사용하도록 한다.</code></pre><p>kubectl apply -f <a href="https://github.com/weaveworks/weave/releases/download/v2.8.1/weave-daemonset-k8s.yaml">https://github.com/weaveworks/weave/releases/download/v2.8.1/weave-daemonset-k8s.yaml</a></p>
<pre><code>- 모든 노드들이 Ready가 되면 성공적</code></pre><p>kubectl get nodes</p>
<pre><code>
### Join Nodes - _★워커 노드만★_
- 클러스터에 새 노드를 추가 (_**복사해둔 kubeadm join …을 여기다가 붙여넣기**_)</code></pre><p>kubeadm join …</p>
<pre><code>- 인증키 다시 발급</code></pre><p>sudo kubeadm token create --print-join-command</p>
<pre><code>
&gt; 설치가 끝난 후에는 모든 노드에 **Snapshot**을 만들도록 하자!</code></pre>